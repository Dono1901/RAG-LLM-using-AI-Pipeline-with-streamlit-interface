{
  "ratio_registry_metadata": {
    "created": "2025-02-13",
    "description": "Canonical registry of financial ratios to prevent duplication and guide implementation",
    "total_registered": 10,
    "usage": "Before implementing new ratio, check registry for canonical form and similar ratios",
    "dedup_criteria": "If cosine similarity > 0.85 against existing ratio, mark as derived_from instead of new"
  },
  "ratios": {
    "current_ratio": {
      "canonical_name": "current_ratio",
      "formula": "current_assets / current_liabilities",
      "variables": ["current_assets", "current_liabilities"],
      "category": "liquidity",
      "first_introduced_phase": "Phase_1",
      "description": "Measures short-term liquidity; ability to pay short-term obligations",
      "interpretation": "Healthy > 1.5; < 1.0 indicates liquidity risk",
      "notes": "Foundation ratio for Phase 1"
    },
    "quick_ratio": {
      "canonical_name": "quick_ratio",
      "formula": "(current_assets - inventory) / current_liabilities",
      "variables": ["current_assets", "inventory", "current_liabilities"],
      "category": "liquidity",
      "first_introduced_phase": "Phase_1",
      "description": "Conservative liquidity measure excluding inventory",
      "interpretation": "Healthy > 1.0; stricter than current_ratio",
      "notes": "Conservative alternative to current_ratio"
    },
    "debt_to_equity": {
      "canonical_name": "debt_to_equity",
      "formula": "total_debt / total_equity",
      "variables": ["total_debt", "total_equity"],
      "category": "leverage",
      "first_introduced_phase": "Phase_1",
      "description": "Leverage ratio; proportion of debt vs equity financing",
      "interpretation": "Lower is safer; > 2.0 indicates high leverage",
      "notes": "Key leverage metric for Phase 1"
    },
    "return_on_assets": {
      "canonical_name": "return_on_assets",
      "alias": "ROA",
      "formula": "net_income / total_assets",
      "variables": ["net_income", "total_assets"],
      "category": "profitability",
      "first_introduced_phase": "Phase_1",
      "description": "Efficiency of asset deployment; profit generated per asset dollar",
      "interpretation": "> 5% is healthy; > 10% is excellent",
      "notes": "Core profitability metric"
    },
    "return_on_equity": {
      "canonical_name": "return_on_equity",
      "alias": "ROE",
      "formula": "net_income / total_equity",
      "variables": ["net_income", "total_equity"],
      "category": "profitability",
      "first_introduced_phase": "Phase_1",
      "description": "Return to shareholders; profit generated per equity dollar",
      "interpretation": "> 15% is healthy; > 20% is excellent",
      "notes": "Core profitability metric; central to DuPont"
    },
    "profit_margin": {
      "canonical_name": "profit_margin",
      "alias": ["net_profit_margin", "net_margin"],
      "formula": "net_income / revenue",
      "variables": ["net_income", "revenue"],
      "category": "profitability",
      "first_introduced_phase": "Phase_1",
      "description": "Profit per revenue dollar; pricing power and cost efficiency",
      "interpretation": "Varies by industry; > 10% is strong",
      "notes": "Foundation metric for DuPont decomposition"
    },
    "asset_turnover": {
      "canonical_name": "asset_turnover",
      "formula": "revenue / total_assets",
      "variables": ["revenue", "total_assets"],
      "category": "efficiency",
      "first_introduced_phase": "Phase_1",
      "description": "Asset utilization; revenue generated per asset dollar",
      "interpretation": "> 1.0 is efficient; varies by industry",
      "notes": "Foundation metric for DuPont decomposition"
    },
    "altman_z_score": {
      "canonical_name": "altman_z_score",
      "alias": "z_score",
      "formula": "1.2*X1 + 1.4*X2 + 3.3*X3 + 0.6*X4 + 1.0*X5",
      "components": {
        "X1": { "name": "working_capital_to_assets", "weight": 1.2 },
        "X2": { "name": "retained_earnings_to_assets", "weight": 1.4 },
        "X3": { "name": "ebit_to_assets", "weight": 3.3 },
        "X4": { "name": "equity_to_liabilities", "weight": 0.6 },
        "X5": { "name": "sales_to_assets", "weight": 1.0 }
      },
      "category": "distress_prediction",
      "first_introduced_phase": "Phase_2",
      "description": "Bankruptcy prediction model; zones: safe (>2.99), grey (1.81-2.99), distress (<1.81)",
      "interpretation": "> 2.99 safe; 1.81-2.99 grey; < 1.81 distress",
      "notes": "Multi-dimensional distress indicator"
    },
    "piotroski_f_score": {
      "canonical_name": "piotroski_f_score",
      "alias": "f_score",
      "formula": "sum(9 binary criteria)",
      "components": [
        "Profitability (4 criteria): ROA, operating_cf, accruals, quality_of_earnings",
        "Leverage/Liquidity (3 criteria): long_term_debt_change, current_ratio_change, shares_change",
        "Operating Efficiency (2 criteria): gross_margin_change, asset_turnover_change"
      ],
      "category": "financial_quality",
      "first_introduced_phase": "Phase_2",
      "description": "Financial quality scorecard; sum of 9 binary signals",
      "interpretation": "8-9 strong; 5-7 moderate; 0-4 weak",
      "notes": "Quality of financial performance indicator"
    },
    "dupont_roe": {
      "canonical_name": "dupont_roe",
      "formula": "profit_margin * asset_turnover * equity_multiplier",
      "components": {
        "profit_margin": { "formula": "net_income / revenue" },
        "asset_turnover": { "formula": "revenue / total_assets" },
        "equity_multiplier": { "formula": "total_assets / total_equity" }
      },
      "category": "decomposition",
      "first_introduced_phase": "Phase_2",
      "description": "3-factor ROE decomposition: profitability x efficiency x leverage",
      "interpretation": "Decomposes ROE into manageable components",
      "variants": {
        "dupont_5_factor": "Decomposes further into profit_margin, tax_burden, interest_burden, operational_efficiency, leverage"
      },
      "notes": "Fundamental analytical framework"
    }
  },
  "dedup_rules": {
    "algebraic_equivalence": [
      {
        "ratio_a": "debt_to_assets",
        "ratio_b": "1 - equity_to_assets",
        "type": "Inverse relationship",
        "action": "Use single canonical implementation; alias others"
      },
      {
        "ratio_a": "roe",
        "ratio_b": "profit_margin * asset_turnover * equity_multiplier",
        "type": "DuPont decomposition",
        "action": "Use DuPont formula as canonical; ROE is derived"
      }
    ],
    "naming_conventions": [
      "Use snake_case for metric names: profit_margin not profitMargin",
      "Use aliases field for alternative names rather than duplicate implementations",
      "Prefix scores with category: z_score, f_score, not just 'score'"
    ]
  },
  "implementation_guidelines": {
    "when_adding_new_ratio": [
      "1. Check ratio_registry.json for similar ratios (similarity check against all existing)",
      "2. If similarity > 0.85, add as alias or derived_from existing ratio",
      "3. If similarity < 0.85 and novel, add entry to registry with formula and variables",
      "4. Add implementation to financial_analyzer.py",
      "5. Create test in appropriate test_phase_X.py file",
      "6. Update ratio_registry.json with first_introduced_phase",
      "7. Commit with message: 'Add [ratio_name] to ratio registry and financial_analyzer'"
    ],
    "dedup_checkpoints": [
      "After Phase 5, 10, 15, 20, etc.: scan ratio_registry.json for algebraic equivalence",
      "Generate similarity matrix of all ratio formulas (use cosine similarity on formula tokens)",
      "Consolidate equivalent implementations",
      "Update registry entries with derived_from links"
    ]
  },
  "analysis_shortcuts": {
    "liquidity_ratios": ["current_ratio", "quick_ratio"],
    "leverage_ratios": ["debt_to_equity"],
    "profitability_ratios": ["return_on_assets", "return_on_equity", "profit_margin"],
    "efficiency_ratios": ["asset_turnover"],
    "distress_indicators": ["altman_z_score", "piotroski_f_score"],
    "decomposition_frameworks": ["dupont_roe"]
  }
}
